@using Umbraco.Cms.Core.Models
@using Umbraco.Cms.Web.Common.PublishedModels;
@inherits Umbraco.Cms.Web.Common.Views.UmbracoViewPage<ContentModels.SplitVideo>
@using ContentModels = Umbraco.Cms.Web.Common.PublishedModels;
@{
	Layout = "masterVideo.cshtml";
	
	var contentId = Model.Id;
    var videoRoot = Model.Value<MediaWithCrops>("rootVideo")?.MediaUrl();
}

<div style="display:flex">
    <div style></div>
    <div>@videoRoot</div>
</div>

<video id="my-video-split" class="video-js vjs-default-skin" controls preload="auto" width="640" height="264">
	<source src="@videoRoot?res=1080" type="application/x-mpegURL" res="1080" label="1080p">
    <source src="@videoRoot?res=720" type="application/x-mpegURL" res="720" label="720p">
    <source src="@videoRoot?res=480" type="application/x-mpegURL" res="480" label="480p">
    <source src="@videoRoot?res=360" type="application/x-mpegURL" res="360" label="360p">
    <source src="@videoRoot?res=auto" type="application/x-mpegURL" res="auto" label="auto">
</video>

@section Scripts {
	<script type="text/javascript">
		document.addEventListener('DOMContentLoaded', async function() {
            var player = videojs('my-video-split', {
                plugins: {
                    videoJsResolutionSwitcher: {
                        default: 'auto',
                        dynamicLabel: true
                    }
                }
            });

			let hasPlayed = false;

            player.on('play', function() {
                hasPlayed = true;
            });

            player.on('resolutionchange', function() {
                if (hasPlayed) {
                    player.play();
                }
            });
		});
	</script>
}